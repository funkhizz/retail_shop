<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Hello, world!</title>
  {% include "base/css.html" %}
  {% block base_head %}
  {% endblock %}
</head>

<body>
  {% include "base/navbar.html" with brand_name="eCommerce" %}
  <div class="container">
      {% block content %}
      {% endblock %}
  </div>

  {% include "base/js.html" %}
  <script>
    $(document).ready(function(){
      var productForm = $(".form-product-ajax")
      productForm.submit(function(event) {
        event.preventDefault();
        var thisForm = $(this)
        var actionEndpoint = thisForm.attr('action');
        var httpMethod = thisForm.attr('method');
        var formData = thisForm.serialize();
        $.ajax({
          url: actionEndpoint,
          method: httpMethod,
          data: formData,
          success: function(data){
            var submitSpan = thisForm.find(".submit-span")
              if (data.added){
                submitSpan.html('In cart <button class="btn btn-info" type="submit">Remove</button>')
              } else {
                submitSpan.html('<button class="btn btn-success" type="submit">Add to cart</button>')
              }
              var navbarCount = $(".navbar-cart-count")
              if (data.count != 0) {
                navbarCount.text(" " + data.count)
              } else {
                navbarCount.text("")
              }


          },
          error: function(errorData){
            console.log("error")
            console.log(errorData)
          },
        })
      })
    })
  </script>

</body>

</html>